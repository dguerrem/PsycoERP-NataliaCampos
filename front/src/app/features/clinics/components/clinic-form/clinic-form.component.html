<app-reusable-modal [isOpen]="isOpen" [title]="title" [subtitle]="'Completa todos los campos requeridos'"
  [submitText]="submitButtonText" [isFormValid]="isFormValid" [actionType]="isEditing ? 'edit' : 'create'"
  (onSubmit)="handleSubmit()" (onCancel)="handleCancel()">

  <!-- Todo el contenido del formulario va aquí -->
  <form id="clinic-form" [formGroup]="clinicaForm" (ngSubmit)="handleSubmit()" class="p-4 sm:p-6 space-y-6">

    <!-- Información Básica de la Clínica -->
    <section class="space-y-4">
      <div class="flex items-center gap-3 pb-3 border-b border-gray-100">
        <div class="p-1.5 bg-blue-100 rounded-md">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-600" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path>
            <path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"></path>
            <path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"></path>
            <path d="M10 6h4"></path>
            <path d="M10 10h4"></path>
            <path d="M10 14h4"></path>
            <path d="M10 18h4"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900">Información de la Clínica</h3>
      </div>

      <div class="space-y-4">
        <!-- Nombre y Color -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <app-form-input controlName="name" label="Nombre de la Clínica" placeholder="Ej: Clínica San Rafael"
            [required]="true">
          </app-form-input>

          <!-- Color Identificativo -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Color Identificativo
              <span class="text-red-500">*</span>
            </label>
            <div class="flex items-center gap-2">
              <input type="color" formControlName="clinic_color"
                class="w-12 h-10 rounded border border-gray-300 bg-gray-50 cursor-pointer hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-[#d29f67]">
              <input type="text" formControlName="clinic_color"
                class="flex h-10 w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-[#d29f67]/20 focus:border-[#d29f67] disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200"
                placeholder="#3b82f6">
            </div>
            @if (getFieldError('clinic_color')) {
            <p class="text-red-600 text-xs mt-2 flex items-center gap-1">
              <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                  clip-rule="evenodd" />
              </svg>
              {{ getFieldError('clinic_color') }}
            </p>
            }
          </div>
        </div>

        <!-- Checkbox Online -->
        <div class="flex items-center gap-2">
          <input id="is_online" type="checkbox" formControlName="is_online"
            class="h-4 w-4 rounded border-gray-300 text-[#d29f67] focus:ring-[#d29f67] focus:ring-2">
          <label for="is_online" class="text-sm font-medium text-gray-700 cursor-pointer">
            Clínica Online (no requiere dirección física)
          </label>
        </div>

        <!-- Dirección -->
        <div class="mt-6">
          <app-form-input controlName="address" label="Dirección"
            [placeholder]="clinicaForm.get('is_online')?.value ? 'Clínica online - No requiere dirección física' : 'Ej: Av. Principal 123, Ciudad'"
            [required]="!clinicaForm.get('is_online')?.value">
          </app-form-input>
        </div>
      </div>
    </section>

    <!-- Información Económica -->
    <section class="space-y-4">
      <div class="flex items-center gap-3 pb-3 border-b border-gray-100">
        <div class="p-1.5 bg-green-100 rounded-md">
          <svg class="h-4 w-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900">Información Económica</h3>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Precio por Sesión -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Precio
            <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <span class="absolute left-3 top-2.5 text-gray-500 text-sm">€</span>
            <input type="number" formControlName="price" min="0" step="0.01"
              class="flex h-10 w-full rounded-md border border-gray-300 bg-gray-50 pl-8 pr-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-[#d29f67]/20 focus:border-[#d29f67] disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200"
              [class.border-red-500]="getFieldError('price')" [class.focus:ring-red-500]="getFieldError('price')"
              [class.focus:border-red-500]="getFieldError('price')" placeholder="0.00">
          </div>
          @if (getFieldError('price')) {
          <p class="text-red-600 text-xs mt-2 flex items-center gap-1">
            <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                clip-rule="evenodd" />
            </svg>
            {{ getFieldError('price') }}
          </p>
          }
        </div>

        <!-- Porcentaje de Comisión -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Porcentaje propio
            <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <input type="number" formControlName="percentage" min="0" max="100" step="0.1"
              class="flex h-10 w-full rounded-md border border-gray-300 bg-gray-50 px-3 pr-8 py-2 text-sm text-gray-900 placeholder:text-gray-400 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-[#d29f67]/20 focus:border-[#d29f67] disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200"
              [class.border-red-500]="getFieldError('percentage')"
              [class.focus:ring-red-500]="getFieldError('percentage')"
              [class.focus:border-red-500]="getFieldError('percentage')" placeholder="0.0">
            <span class="absolute right-3 top-2.5 text-gray-500 text-sm">%</span>
          </div>
          @if (getFieldError('percentage')) {
          <p class="text-red-600 text-xs mt-2 flex items-center gap-1">
            <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                clip-rule="evenodd" />
            </svg>
            {{ getFieldError('percentage') }}
          </p>
          }
        </div>
      </div>

      <!-- Facturación -->
      <div class="space-y-4 mt-6">
        <!-- Checkbox Es Facturable -->
        <div class="flex items-center gap-2">
          <input id="is_billable" type="checkbox" formControlName="is_billable"
            class="h-4 w-4 rounded border-gray-300 text-[#d29f67] focus:ring-[#d29f67] focus:ring-2">
          <label for="is_billable" class="text-sm font-medium text-gray-700 cursor-pointer">
            Es facturable (requiere CIF)
          </label>
        </div>

        <!-- CIF -->
        <div>
          <app-form-input controlName="cif" label="CIF"
            [placeholder]="clinicaForm.get('is_billable')?.value ? 'Ej: A12345678' : 'No facturable - CIF no requerido'"
            [required]="clinicaForm.get('is_billable')?.value">
          </app-form-input>
        </div>

        <!-- Nombre Fiscal -->
        <div>
          <app-form-input controlName="fiscal_name" label="Nombre Fiscal"
            [placeholder]="clinicaForm.get('is_billable')?.value ? 'Ej: Clínica San Rafael S.L.' : 'No facturable - Nombre fiscal no requerido'"
            [required]="clinicaForm.get('is_billable')?.value">
          </app-form-input>
        </div>

        <!-- Dirección de Facturación -->
        <div>
          <app-form-input controlName="billing_address" label="Dirección de Facturación"
            [placeholder]="clinicaForm.get('is_billable')?.value ? 'Ej: Calle Principal 123, Madrid' : 'No facturable - Dirección no requerida'"
            [required]="clinicaForm.get('is_billable')?.value">
          </app-form-input>
        </div>
      </div>
    </section>
  </form>
</app-reusable-modal>
